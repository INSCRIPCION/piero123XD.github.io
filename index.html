<!DOCTYPE html>
<html>
<head>
    <title>2</title>
</head>
<body>
    <div id="inputs">
        <!-- Generar 12 inputs con un bucle -->
        <input type="text" placeholder="Escribe un mensaje" id="mensaje0">
        <button onclick="editarMensaje(0)">Editar</button>
        <input type="text" placeholder="Escribe un mensaje" id="mensaje1">
        <input type="text" placeholder="Escribe un mensaje" id="mensaje2">
        <input type="text" placeholder="Escribe un mensaje" id="mensaje3">
        <input type="text" placeholder="Escribe un mensaje" id="mensaje4">
        <input type="text" placeholder="Escribe un mensaje" id="mensaje5">
        <input type="text" placeholder="Escribe un mensaje" id="mensaje6">
        <input type="text" placeholder="Escribe un mensaje" id="mensaje7">
        <input type="text" placeholder="Escribe un mensaje" id="mensaje8">
        <input type="text" placeholder="Escribe un mensaje" id="mensaje9">
        <input type="text" placeholder="Escribe un mensaje" id="mensaje10">
        <input type="text" placeholder="Escribe un mensaje" id="mensaje11">
    </div>
    
    <script>
        var socket = new WebSocket("ws://localhost:8769");
        var mensajes = [];

        socket.onopen = function(event) {
            console.log("Conexión WebSocket abierta");
        };

        socket.onmessage = function(event) {
            console.log("Mensaje recibido del servidor: " + event.data);
        };

        socket.onclose = function(event) {
            if (event.wasClean) {
                console.log("Conexión WebSocket cerrada de manera limpia, código=" + event.code);
            } else {
                console.error("Conexión WebSocket cerrada de manera inesperada");
            }
        };

        socket.onerror = function(error) {
            console.error("Error en la conexión WebSocket: " + error.message);
        };

        // Agrega un controlador de eventos "blur" a cada campo de entrada
        var inputElements = document.querySelectorAll('input[type="text"]');
        inputElements.forEach(function(inputElement, index) {
            inputElement.addEventListener('blur', function(event) {
                enviarMensaje(inputElement, index);
            });
        });

        function enviarMensaje(inputElement, index) {
            mensajes[index] = inputElement.value;
            socket.send(JSON.stringify(mensajes));
        }

        function editarMensaje(index) {
    var inputElement = document.getElementById('mensaje' + index);
    if (inputElement) {
        // Habilita la edición del campo de entrada
        inputElement.disabled = false;
        inputElement.focus();
        inputElement.select(); // Selecciona el texto para facilitar la edición
        inputElement.addEventListener('blur', function() {
            // Cuando se pierde el foco, guarda el mensaje editado
            mensajes[index] = inputElement.value;

            // Envía el mensaje editado al servidor
            socket.send(JSON.stringify(mensajes));
            inputElement.disabled = true; // Vuelve a deshabilitar el campo de entrada
        });
    }
}
        
    </script>
</body>
</html>
